<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <!-- Mobile friendly viewport + iOS safe area -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SEA Happiness Data ¬∑ Sodaro Visualization 2025</title>

  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js" defer></script>
  <script src="sketch.js" defer></script>

  <meta name="theme-color" content="#0CAFFF" />
  <meta property="og:title" content="Sodaro ¬∑ SEA Happiness Visualization 2025" />
  <meta property="og:description" content="Electric-blue interactive data visualization built in p5.js by Bullimalinna Sot." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg-0:#0b0f14;
      --bg-1:#12161d;
      --fg-1:#e7eef8;
      --fg-2:#9fb0c8;
      --brand:#0CAFFF;
      --muted:#1f2630;
      --radius:14px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      /* Mobile 100vh fix */
      --vh: 1vh;
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-top: env(safe-area-inset-top, 0px);
    }

    *{box-sizing:border-box; -webkit-tap-highlight-color: transparent;}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--fg-1);
      background:
        radial-gradient(1200px 600px at 20% -10%, #122033 0%, transparent 60%),
        radial-gradient(900px 500px at 120% 20%, #101a2a 0%, transparent 55%),
        var(--bg-0);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      display:flex; flex-direction:column; gap:16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      /* Prevent body jump when keyboard opens on iOS */
      min-height: calc(var(--vh) * 100);
    }

    header{
      position:relative; z-index:1;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px clamp(12px,4vw,28px);
    }
    .brand{display:flex; flex-direction:column; text-decoration:none; color:var(--fg-1);}
    .title{font-weight:700; font-size:clamp(18px,2.3vw,22px);}
    .subtitle{color:var(--fg-2); font-size:clamp(12px,1.6vw,14px);}
    .back-link{
      color:var(--fg-2); text-decoration:none;
      padding:10px 14px; border:1px solid var(--muted);
      border-radius:10px; transition:.2s ease;
    }
    .back-link:hover{color:var(--fg-1); border-color:#2b3542;}

    /* Stage holds the canvas; keep it behind overlays */
    .stage{
      position:relative;
      padding: clamp(8px,2vw,16px);
      margin: 0 clamp(8px,3vw,28px);
      border-radius:var(--radius);
      background:rgba(18,22,29,.55);
      backdrop-filter:blur(6px);
      box-shadow:var(--shadow);
      overflow:hidden;
      opacity:0; transform:translateY(10px);
      transition:opacity .35s ease,transform .35s ease;
      /* Leave room for bottom safe area on mobile */
      padding-bottom: calc(clamp(8px,2vw,16px) + var(--safe-bottom));
    }
    .stage.ready{opacity:1;transform:translateY(0);}
    /* Keep canvas centered and not stretching oddly */
    canvas{display:block;margin:0 auto;max-width:100%;height:auto;touch-action:manipulation;}

    footer{
      margin:0 clamp(8px,3vw,28px) calc(clamp(10px,3vh,20px) + var(--safe-bottom));
      background:var(--bg-1); border:1px solid var(--muted);
      border-radius:var(--radius); box-shadow:var(--shadow);
      padding:14px clamp(14px,3vw,22px);
      display:flex; align-items:center; justify-content:space-between;
      flex-wrap:wrap; font-size:14px; color:var(--fg-2);
    }
    footer a{color:var(--fg-1);text-decoration:none;}
    footer a:hover{color:var(--brand);}

    /* Splash (on top) */
    .splash{
      position:fixed; inset:0; z-index:30;
      display:grid; place-items:center;
      background:radial-gradient(1600px 800px at 50% -10%, #10151d 0%, transparent 65%), #04070b;
      animation:splashFadeOut .4s ease forwards; animation-delay:1.6s;
    }
    .hidden{display:none!important;} /* <‚Äî real hide to avoid intercepting taps */
    .splash .logo-big{
      width:min(240px,42vmin); height:min(240px,42vmin);
      object-fit:contain; border-radius:24px;
      animation:bootSpin 1.2s ease-out,bootSettle .9s cubic-bezier(.2,.9,.2,1) .9s forwards;
    }
    .scanlines{
      position:absolute; inset:0; pointer-events:none;
      background:repeating-linear-gradient(to bottom,rgba(255,255,255,.1) 0 1px,transparent 3px 4px);
      mix-blend-mode:overlay; animation:flicker 1.2s linear infinite; opacity:.14;
    }
    @keyframes bootSpin{0%{transform:scale(.7) rotate(-8deg);opacity:0}
      40%{opacity:1}60%{transform:scale(1.06) rotate(0)}100%{transform:scale(1)}}
    @keyframes bootSettle{from{transform:scale(1)}to{transform:scale(.96)}}
    @keyframes splashFadeOut{to{opacity:0;pointer-events:none}}
    @keyframes flicker{0%,100%{opacity:.14}50%{opacity:.1}}
    @media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}

    /* Gate (login) above stage, below splash */
    .gate{
      position:fixed; inset:0; z-index:20;
      display:grid; place-items:center;
      background:radial-gradient(1100px 600px at 15% -10%,rgba(40,80,110,.35) 0%,transparent 60%),
                 radial-gradient(900px 500px at 120% 20%,rgba(40,80,110,.25) 0%,transparent 55%),
                 rgba(7,10,14,.92);
      opacity:0; pointer-events:none; transition:opacity .35s ease;
      padding-bottom: var(--safe-bottom);
    }
    .card{
      width:min(560px,92vw); background:rgba(18,22,29,.88);
      border:1px solid var(--muted); border-radius:16px; box-shadow:var(--shadow);
      padding:clamp(18px,3vw,26px); text-align:center;
    }
    .auth-logo{
      width:72px;height:72px;margin:4px auto 14px auto;
      object-fit:contain; border-radius:18px;opacity:0;transition:opacity .35s ease;
    }
    .product .gem{width:10px;height:10px;border-radius:999px;background:var(--brand);}
    .product{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:8px;}
    .product .name{font-weight:700;font-size:clamp(16px,2vw,20px);}
    .tagline{color:var(--fg-2);font-size:clamp(12px,1.5vw,14px);}
    .form{display:grid;gap:12px;margin-top:12px;}
    label{color:var(--fg-2);font-size:13px;}
    input[type=text]{
      width:100%;padding:12px;border-radius:10px;background:#0f141b;color:var(--fg-1);
      border:1px solid var(--muted);outline:none;font-size:16px; /* 16px to prevent iOS zoom */
      -webkit-text-size-adjust: 100%;
    }
    input[type=text]:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(12,175,255,.15);}
    .actions{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;}
    .btn{cursor:pointer;padding:10px 14px;border-radius:10px;border:1px solid #2b3542;
      background:rgba(255,255,255,.02);color:var(--fg-1);font-weight:600;font-size:14px;transition:.2s;}
    .btn:hover{border-color:var(--brand);color:var(--brand);}
    .error{color:#ff7a7a;font-size:13px;min-height:18px;}

    @media(max-width:720px){
      .subtitle{display:none;}
      .stage{padding:10px;}
      footer{font-size:13px;gap:8px;}
      .back-link{padding:8px 12px;}
    }
  </style>
</head>
<body>
  <header>
    <a class="brand" href="#">
      <div class="title">Harmony & Data ¬∑ SEA Happiness Study 2019</div>
      <div class="subtitle">Interaction Design Data Visualization</div>
    </a>
    <a class="back-link" href="https://www.jayaproduction.com">‚Üê Back</a>
  </header>

  <!-- Splash -->
  <section class="splash" id="splash">
    <img src="sodaro_logo.png" alt="Sodaro Logo" class="logo-big" />
    <div class="scanlines" aria-hidden="true"></div>
  </section>

  <!-- Sign-in -->
  <section class="gate" id="gate" aria-modal="true" role="dialog">
    <div class="card">
      <img src="sodaro_logo.png" alt="Sodaro Logo" class="auth-logo" id="authLogo" />
      <div class="product">
        <span class="gem"></span><div id="gateTitle" class="name">Sign in to continue</div>
      </div>
      <div class="tagline"> Access restricted: SEA Happiness Data ¬∑ 2019 ‚Äî encrypted visualization of regional well-being</div>

      <form class="form" id="gateForm" novalidate>
        <div class="field">
          <label for="passphrase">SEA Access Key</label>
          <input
            id="passphrase"
            type="text"
            placeholder="Type: Southeast Asia"
            autocomplete="one-time-code"
            autocapitalize="none"
            autocorrect="off"
            spellcheck="false"
            inputmode="text"
            enterkeyhint="go"
          />
          <div id="error" class="error" aria-live="polite"></div>
        </div>
        <div class="actions">
          <button class="btn" id="enterBtn" type="submit">Enter</button>
          <button class="btn" id="rememberBtn" type="button" aria-pressed="false">Remember device</button>
        </div>
      </form>
    </div>
  </section>

  <main class="stage" id="stage" aria-label="Visualization">
    <div id="app"></div>
  </main>

  <footer>
    <div>¬© <span id="year"></span> Bullimalinna Sot ¬∑ Interaction Design & Interactive Art MM621 ‚Äî ‚ÄúDesigning happiness, not just pixels.‚Äù</div>
    <div class="footer-links">
      <a href="https://worldhappiness.report/ed/2019/" target="_blank" class="highlight-btn">üåè 2019 Data Source</a> ¬∑
      <a href="https://github.com/khmerxbxboi/MM621_Project-2-Data-Visualization" target="_blank">GitHub Repo</a> ¬∑
      <a href="inspiration.html">üí° Inspiration</a>
    </div>
  </footer>

<script>
  // ---- Mobile 100vh fix (iOS keyboard safe) ----
  const setVH = () => {
    const vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
  };
  setVH();
  window.addEventListener('resize', setVH);

  // Footer year
  document.getElementById("year").textContent = new Date().getFullYear();

  // If your p5 sketch uses parent('app') you don't need to re-attach.
  // This is just a safe fallback without aggressive intervals.
  window.addEventListener("load", () => {
    const app = document.getElementById("app");
    const canv = document.querySelector("canvas");
    if (app && canv && !app.contains(canv)) app.appendChild(canv);
  });

  // -------- Boot / Login logic --------
  const PASS = "southeast asia";
  const STORAGE_KEY = "sea_demo_access_v3";
  const url = new URL(window.location.href);
  const forceBoot = url.searchParams.get("boot") === "1";
  const doReset   = url.searchParams.get("reset") === "1";
  if (doReset) { try { localStorage.removeItem(STORAGE_KEY); } catch(_) {} }

  const splash = document.getElementById("splash");
  const gate   = document.getElementById("gate");
  const logo   = document.getElementById("authLogo");
  const stageEl  = document.getElementById("stage");
  const input  = document.getElementById("passphrase");
  const error  = document.getElementById("error");
  const rememberBtn = document.getElementById("rememberBtn");
  const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  const remembered = !forceBoot && (localStorage.getItem(STORAGE_KEY) === "1");

  function reallyHide(el){
    el.classList.add("hidden"); // display:none so it never intercepts taps
    el.style.opacity = "0";
    el.style.pointerEvents = "none";
  }
  function showGate(){
    gate.classList.remove("hidden");
    gate.style.opacity = "1";
    gate.style.pointerEvents = "auto";
    setTimeout(()=> { logo.style.opacity = "1"; }, 120);
    // Scroll into view to avoid keyboard obstruction
    setTimeout(()=> { input?.focus({ preventScroll:false }); input?.scrollIntoView({ block:"center" }); }, 250);
  }

  if (remembered) {
    reallyHide(splash);
    reallyHide(gate);
    stageEl.classList.add("ready");
  } else {
    if (prefersReduced) {
      splash.style.animation = "none";
      setTimeout(()=>{ reallyHide(splash); showGate(); }, 300);
    } else {
      setTimeout(()=>{ reallyHide(splash); showGate(); }, 1400);
    }
  }

  rememberBtn.addEventListener("click", ()=>{
    const pressed = rememberBtn.getAttribute("aria-pressed") === "true";
    rememberBtn.setAttribute("aria-pressed", (!pressed).toString());
    rememberBtn.style.borderColor = pressed ? "#2b3542" : "var(--brand)";
    rememberBtn.style.color = pressed ? "var(--fg-1)" : "var(--brand)";
  });

  document.getElementById("gateForm").addEventListener("submit", (e)=>{
    e.preventDefault();
    const ok = (input.value || "").trim().toLowerCase() === PASS;
    if (!ok) { error.textContent = 'Incorrect key. Hint: "Southeast Asia"'; input.select(); return; }
    error.textContent = "";

    // Disable overlay COMPLETELY so canvas receives input/touch
    reallyHide(gate);
    reallyHide(splash);
    stageEl.classList.add("ready");

    if (rememberBtn.getAttribute("aria-pressed") === "true") {
      try { localStorage.setItem(STORAGE_KEY, "1"); } catch(_) {}
    }
  });

  input.addEventListener("keydown", (e)=>{ if (e.key === "Enter") e.target.form.requestSubmit(); });

  // Prevent body scroll bounce while interacting with canvas on mobile
  document.addEventListener('touchmove', (e)=>{
    // Allow scrolling only when gate is visible
    if (!gate.classList.contains('hidden')) return;
    // If touching inside canvas, prevent overscroll
    const c = document.querySelector('canvas');
    if (c && c.contains(e.target)) e.preventDefault();
  }, { passive:false });
</script>
</body>
</html>
