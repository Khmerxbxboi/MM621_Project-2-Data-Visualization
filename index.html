<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SEA Happiness Data · Sodaro Visualization 2025</title>

  <!-- p5.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js" defer></script>
  <script src="sketch.js" defer></script>

  <meta name="theme-color" content="#0CAFFF" />
  <meta property="og:title" content="Sodaro · SEA Happiness Visualization 2025" />
  <meta property="og:description" content="Electric-blue interactive data visualization built in p5.js by Bullimalinna Sot." />
  <meta property="og:type" content="website" />

  <style>
    :root{
      --bg-0:#0b0f14;
      --bg-1:#12161d;
      --fg-1:#e7eef8;
      --fg-2:#9fb0c8;
      --brand:#0CAFFF;   /* Sodaro blue */
      --muted:#1f2630;
      --radius:14px;
      --shadow:0 10px 30px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      color:var(--fg-1);
      background:
        radial-gradient(1200px 600px at 20% -10%, #122033 0%, transparent 60%),
        radial-gradient(900px 500px at 120% 20%, #101a2a 0%, transparent 55%),
        var(--bg-0);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      display:flex; flex-direction:column; gap:16px;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:14px clamp(12px,4vw,28px);
    }
    .brand{display:flex; flex-direction:column; text-decoration:none; color:var(--fg-1);}
    .title{font-weight:700; font-size:clamp(18px,2.3vw,22px);}
    .subtitle{color:var(--fg-2); font-size:clamp(12px,1.6vw,14px);}
    .back-link{
      color:var(--fg-2); text-decoration:none;
      padding:10px 14px; border:1px solid var(--muted);
      border-radius:10px; transition:.2s ease;
    }
    .back-link:hover{color:var(--fg-1); border-color:#2b3542;}

    .stage{
      position:relative;
      padding: clamp(8px,2vw,16px);
      margin: 0 clamp(8px,3vw,28px);
      border-radius:var(--radius);
      background:rgba(18,22,29,.55);
      backdrop-filter:blur(6px);
      box-shadow:var(--shadow);
      /* FIX: allow floating UI like detail modals/tooltips to escape clipping */
      overflow: visible;
      opacity:0; transform:translateY(10px);
      transition:opacity .35s ease,transform .35s ease;
    }
    .stage.ready{opacity:1;transform:translateY(0);}
    canvas{display:block;margin:0 auto;max-width:100%;}

    footer{
      margin:0 clamp(8px,3vw,28px) clamp(10px,3vh,20px);
      background:var(--bg-1); border:1px solid var(--muted);
      border-radius:var(--radius); box-shadow:var(--shadow);
      padding:14px clamp(14px,3vw,22px);
      display:flex; align-items:center; justify-content:space-between;
      flex-wrap:wrap; font-size:14px; color:var(--fg-2);
    }
    footer a{color:var(--fg-1);text-decoration:none;}
    footer a:hover{color:var(--brand);}

    /* --- Splash (PS1-style) --- */
    .splash{
      position:fixed; inset:0; z-index:20;
      display:grid; place-items:center;
      background:radial-gradient(1600px 800px at 50% -10%, #10151d 0%, transparent 65%), #04070b;
      animation:splashFadeOut .4s ease forwards; animation-delay:1.6s;
    }
    .splash.hidden{display:none;}
    .splash .logo-big{
      width:min(240px,42vmin); height:min(240px,42vmin);
      object-fit:contain; border-radius:24px;
      animation:bootSpin 1.2s ease-out,bootSettle .9s cubic-bezier(.2,.9,.2,1) .9s forwards;
    }
    .scanlines{
      position:absolute; inset:0; pointer-events:none;
      background:repeating-linear-gradient(to bottom,rgba(255,255,255,.1) 0 1px,transparent 3px 4px);
      mix-blend-mode:overlay; animation:flicker 1.2s linear infinite; opacity:.14;
    }
    @keyframes bootSpin{0%{transform:scale(.7) rotate(-8deg);opacity:0}
      40%{opacity:1}60%{transform:scale(1.06) rotate(0)}100%{transform:scale(1)}}
    @keyframes bootSettle{from{transform:scale(1)}to{transform:scale(.96)}}
    @keyframes splashFadeOut{to{opacity:0;pointer-events:none}}
    @keyframes flicker{0%,100%{opacity:.14}50%{opacity:.1}}
    @media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important}}

    /* Login Gate */
    .gate{
      position:fixed; inset:0; z-index:10;
      display:grid; place-items:center;
      background:radial-gradient(1100px 600px at 15% -10%,rgba(40,80,110,.35) 0%,transparent 60%),
                 radial-gradient(900px 500px at 120% 20%,rgba(40,80,110,.25) 0%,transparent 55%),
                 rgba(7,10,14,.92);
      opacity:0; pointer-events:none; transition:opacity .35s ease;
    }
    .card{
      width:min(560px,92vw); background:rgba(18,22,29,.82);
      border:1px solid var(--muted); border-radius:16px; box-shadow:var(--shadow);
      padding:clamp(18px,3vw,26px); text-align:center;
    }
    .auth-logo{
      width:72px;height:72px;margin:4px auto 14px auto;
      object-fit:contain; border-radius:18px;opacity:0;transition:opacity .35s ease;
    }
    .product .gem{width:10px;height:10px;border-radius:999px;background:var(--brand);}
    .product{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:8px;}
    .product .name{font-weight:700;font-size:clamp(16px,2vw,20px);}
    .tagline{color:var(--fg-2);font-size:clamp(12px,1.5vw,14px);}
    .form{display:grid;gap:12px;margin-top:12px;}
    label{color:var(--fg-2);font-size:13px;}
    input[type=text]{
      width:100%;padding:12px;border-radius:10px;background:#0f141b;color:var(--fg-1);
      border:1px solid var(--muted);outline:none;font-size:15px;
    }
    input[type=text]:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(12,175,255,.15);}
    .actions{display:flex;justify-content:center;gap:10px;}
    .btn{cursor:pointer;padding:10px 14px;border-radius:10px;border:1px solid #2b3542;
      background:rgba(255,255,255,.02);color:var(--fg-1);font-weight:600;font-size:14px;transition:.2s;}
    .btn:hover{border-color:var(--brand);color:var(--brand);}
    .error{color:#ff7a7a;font-size:13px;min-height:18px;}

    @media(max-width:720px){
      .subtitle{display:none;}
      .stage{padding:10px;}
      footer{font-size:13px;gap:8px;}
      .back-link{padding:8px 12px;}
    }

    /* ===== FIXES: metric toolbar + detail modal (no overlap) ===== */

    /* If your sketch adds a toolbar element, give it this class or ID */
    .metric-toolbar{
      position:fixed;
      left:16px; bottom:16px;
      z-index:10;
      display:flex; gap:8px;
      padding:10px;
      border:1px solid #2b3542; border-radius:12px;
      background:rgba(18,22,29,.7);
      backdrop-filter:blur(6px);
    }

    /* Detail modal/card stays above everything and never gets clipped */
    .score-detail{
      position:fixed;
      left:50%; top:50%;
      transform:translate(-50%,-50%);
      z-index:1000;                     /* above toolbar */
      min-width:min(680px,92vw); max-width:92vw;
      border-radius:16px; border:1px solid #2b3542;
      background:rgba(18,22,29,.92);
      box-shadow:var(--shadow);
      padding:16px 20px 18px;
    }

    /* Close “X” built with CSS so it won’t show as a dash */
    .modal-close{
      position:absolute; top:10px; right:12px;
      width:28px; height:28px;
      border:0; background:transparent; color:#cfe3ff;
      cursor:pointer;
    }
    .modal-close:hover{ color:#fff; }
    .modal-close::before, .modal-close::after{
      content:""; position:absolute; left:5px; top:13px;
      width:18px; height:2px; background:currentColor; border-radius:1px;
    }
    .modal-close::before{ transform:rotate(45deg); }
    .modal-close::after { transform:rotate(-45deg); }

    /* Optional: while detail is open, ignore toolbar clicks */
    .app--detail-open .metric-toolbar{
      pointer-events:none; opacity:.6;
    }
  </style>
</head>
<body>
  <header>
    <a class="brand" href="#">
      <div class="title">SEA Happiness Data · 2019</div>
      <div class="subtitle">Interaction Design Data Visualization</div>
    </a>
    <a class="back-link" href="https://www.jayaproduction.com">← Back</a>
  </header>

  <!-- Splash -->
  <section class="splash" id="splash">
    <img src="sodaro_logo.png" alt="Sodaro Logo" class="logo-big" />
    <div class="scanlines" aria-hidden="true"></div>
  </section>

  <!-- Sign-in -->
  <section class="gate" id="gate">
    <div class="card">
      <img src="sodaro_logo.png" alt="Sodaro Logo" class="auth-logo" id="authLogo" />
      <div class="product">
        <span class="gem"></span><div id="gateTitle" class="name">Sign in to continue</div>
      </div>
      <div class="tagline"> Access restricted: SEA Happiness Data · 2019 - an encrypted visualization of regional well-being through design intelligence</div>

      <form class="form" id="gateForm">
        <div class="field">
          <label for="passphrase">SEA Access Key</label>
          <input id="passphrase" type="text" placeholder="Type: Southeast Asia" autocomplete="off" />
          <div id="error" class="error"></div>
        </div>
        <div class="actions">
          <button class="btn" id="enterBtn" type="submit">Enter</button>
          <button class="btn" id="rememberBtn" type="button" aria-pressed="false">Remember device</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Main Stage -->
  <main class="stage" id="stage">
    <div id="app"></div>
  </main>

  <footer>
    <div>© <span id="year"></span> Bullimalinna Sot · Interaction Design & Interactive  - “A 2019 snapshot of happiness — because design isn’t just pixels, it’s people.”</div>
    <div><a href="#">Built for modern web</a></div>
  </footer>

<script>
  // Footer year
  document.getElementById("year").textContent = new Date().getFullYear();

  // Attach p5 canvas (safe even if sketch already parents to #app)
  const attach = () => {
    let tries=0;
    const t=setInterval(()=>{
      if(window._renderer&&window._renderer.canvas){
        try{document.getElementById("app")?.appendChild(window._renderer.canvas);clearInterval(t);}
        catch(e){clearInterval(t);}
      }
      if(++tries>40)clearInterval(t);
    },100);
  };
  if(document.readyState==="complete")attach(); else window.addEventListener("load",attach);

  // -------- Boot / Login logic --------
  const PASS = "southeast asia";
  const STORAGE_KEY = "sea_demo_access_v2";   // new key
  const url = new URL(window.location.href);
  const forceBoot = url.searchParams.get("boot") === "1";
  const doReset   = url.searchParams.get("reset") === "1";
  if (doReset) { try { localStorage.removeItem(STORAGE_KEY); } catch(_) {} }

  const splash = document.getElementById("splash");
  const gate   = document.getElementById("gate");
  const logo   = document.getElementById("authLogo");
  const stageEl  = document.getElementById("stage"); // renamed to avoid confusions
  const input  = document.getElementById("passphrase");
  const error  = document.getElementById("error");
  const rememberBtn = document.getElementById("rememberBtn");
  const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
  const remembered = !forceBoot && (localStorage.getItem(STORAGE_KEY) === "1");

  function showGate(){
    gate.style.opacity = "1";
    gate.style.pointerEvents = "auto";
    setTimeout(()=> logo.style.opacity = "1", 200);
    setTimeout(()=> input?.focus(), 400);
  }

  if (remembered) {
    splash.classList.add("hidden");
    gate.style.opacity = "0";            // ⚡ ensure hidden
    gate.style.pointerEvents = "none";   // ⚡ ensure not blocking
    stageEl.classList.add("ready");
  } else {
    if (prefersReduced) {
      splash.style.animation = "none";
      setTimeout(()=>{ splash.classList.add("hidden"); showGate(); }, 400);
    } else {
      setTimeout(()=>{ splash.classList.add("hidden"); showGate(); }, 2000);
    }
  }

  rememberBtn.addEventListener("click", ()=>{
    const pressed = rememberBtn.getAttribute("aria-pressed") === "true";
    rememberBtn.setAttribute("aria-pressed", (!pressed).toString());
    rememberBtn.style.borderColor = pressed ? "#2b3542" : "var(--brand)";
    rememberBtn.style.color = pressed ? "var(--fg-1)" : "var(--brand)";
  });

  document.getElementById("gateForm").addEventListener("submit", (e)=>{
    e.preventDefault();
    const ok = (input.value || "").trim().toLowerCase() === PASS;
    if (!ok) { error.textContent = 'Incorrect key. Hint: "Southeast Asia"'; input.select(); return; }
    error.textContent = "";

    // ⚡ Actively disable the overlay so p5 is interactive
    gate.style.opacity = "0";
    gate.style.pointerEvents = "none";
    splash.classList.add("hidden");
    stageEl.classList.add("ready");

    if (rememberBtn.getAttribute("aria-pressed") === "true") {
      try { localStorage.setItem(STORAGE_KEY, "1"); } catch(_) {}
    }
  });

  input.addEventListener("keydown", (e)=>{ if (e.key === "Enter") e.target.form.requestSubmit(); });
</script>

</body>
</html>
